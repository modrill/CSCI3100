<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buyzu ¬∑ Home</title>
  <style>
    /* Reset */
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: Arial, sans-serif; background: #F7FFF7; color: #1A1F36; line-height:1.5; }
    a { color: inherit; text-decoration: none; }

    /* Utility */
    .container { width:90%; max-width:1200px; margin:0 auto; }
    .glass { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius:12px; box-shadow:0 8px 32px rgba(0,0,0,0.1); }

    /* Header */
    header { position: sticky; top:0; z-index:100; background: rgba(255,255,255,0.8); backdrop-filter: blur(8px); }
    .nav-wrapper { display:flex; align-items:center; justify-content:space-between; padding:1rem 0; }
    .logo { font-size:1.5rem; font-weight:bold; color:#FF6B6B; }
    .search-cart { display:flex; align-items:center; gap:2rem; }
    .search-cart input { padding:.5rem 1rem; border:none; border-radius:20px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .search-cart .icon { font-size:1.5rem; cursor:pointer; }
    .auth-buttons { display:flex; gap:1rem; }
    .auth-buttons .btn { padding:.4rem .8rem; border-radius:20px; font-size:.9rem; cursor:pointer; transition:.25s; }
    .auth-buttons .login { background:transparent; border:1px solid #1A1F36; color:#1A1F36; }
    .auth-buttons .register { background:#FF6B6B; border:none; color:#fff; }
    .auth-buttons .btn:hover { opacity:.85; }

    /* Hero Banner */
    .hero-banner { background: linear-gradient(135deg,#FF6B6B,#FFD93D); color:#fff; padding:4rem 0; }
    .hero-banner .container { text-align:center; }
    .hero-banner h1 { font-size:2.75rem; margin-bottom:.5rem; }
    .hero-banner p { font-size:1.2rem; opacity:.9; }

    /* Modified Related-to Banner */
    .reco-banner { background: #F0F1F3; padding:2rem 0 4rem; }
    .reco-banner .container { }
    .reco-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
    .reco-header h2 { font-size:1.5rem; margin:0; color:#1A1F36; }
    .reco-header .refresh {
      padding:.4rem .8rem;
      border:1px solid #1A1F36;
      border-radius:20px;
      background:transparent;
      font-size:.9rem;
      cursor:pointer;
      transition:.25s;
      color:#1A1F36;
    }
    .reco-header .refresh:hover { background:#E5E7EB; }

    /* Carousel (single‚Äêcard view) */
    .carousel-hero { position:relative; width:100%; overflow:auto; }
    .track { display:flex; justify-content:center; }
    .reco-card { flex:0 0 300px; max-width:300px; background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 16px rgba(0,0,0,0.1); transition:transform .25s; margin:0 .5rem; }
    .reco-card.fade-in { animation: slideFadeIn .55s cubic-bezier(.25,.8,.35,1) both; }
    .reco-card img { width:100%; aspect-ratio:1/1; object-fit:cover; }
    .reco-body { padding:.5rem; color:#1A1F36; }
    .reco-name { font-size:1rem; font-weight:600; line-height:1.6em; height:3.2em; overflow:hidden; }
    .reco-brand { font-size:.8rem; color:#6b7280; margin:.25rem 0; }
    .reco-price { color:#d9230f; font-weight:700; font-size:1rem; }
    .nav-arrow { position:absolute; top:50%; transform:translateY(-50%); width:30px; height:30px;
                 background:rgba(0,0,0,.3); color:#fff; border-radius:50%; display:flex;
                 align-items:center; justify-content:center; cursor:pointer; transition:.25s; z-index:5; }
    .nav-prev { left:2%; }
    .nav-next { right:2%; }
    .nav-arrow:hover { background:rgba(0,0,0,.5); }
    .nav-arrow svg { width:18px; height:18px; fill:currentColor; }
    @keyframes slideFadeIn {
      0% { opacity:0; transform: translateX(40px) scale(.96); }
      100% { opacity:1; transform: none; }
    }

    /* ‚Äî‚Äî Hot Sellers ‰∏é Related-to ÂÖ±Áî®Áº©Â∞èÁâàÂç°Áâá ‚Äî‚Äî */
    #hotProducts {
      display: flex;
      flex-wrap: nowrap;
      gap: 1rem;
      overflow-x: auto;
      padding-bottom: 1rem;
    }
    .reco-card.small {
      flex:0 0 200px;
      max-width:200px;
      margin:0 .5rem;
    }
    .reco-card.small img {
      width:100%; aspect-ratio:1/1; object-fit:cover;
    }
    .reco-name.small { font-size:0.8rem; font-weight:600; line-height:1.2em; height:2.4em; overflow:auto; }
    .reco-brand.small { font-size:.6rem; color:#6b7280; margin:.25rem 0; }
    .reco-price.small { color:#d9230f; font-weight:600; font-size:0.8rem; }

    /* CategoriesÔºàÊñ∞ËÆæËÆ°Ôºâ */
    .categories { padding:2rem 0 4rem; }
    .categories h2 { font-size:2rem; text-align:center; margin-bottom:2rem; color:#1A1F36; }
    .cat-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1.5rem; }

    .cat-card {
      position:relative;
      height:150px;
      border-radius:12px;
      overflow:hidden;
      cursor:pointer;
      transition:transform .3s,box-shadow .3s;
    }
    .cat-card:hover {
      transform:translateY(-5px);
      box-shadow:0 8px 24px rgba(0,0,0,0.2);
    }
    .cat-card img {
      position:absolute;
      top:0; left:0;
      width:100%; aspect-ratio:1.95/1;
      object-fit:cover;
    }
    .cat-label {
      position:absolute;
      bottom:0; left:0; right:0;
      padding:.5rem .5rem;
      font-size:1.2rem; font-weight:bold;
      color:#fff;
    }
    .cat-1  .cat-label { background:linear-gradient(45deg,#00C9FF,#92FE9D); }
    .cat-2  .cat-label { background:linear-gradient(45deg,#7F00FF,#E100FF); }
    .cat-3  .cat-label { background:linear-gradient(45deg,#FF512F,#DD2476); }
    .cat-4  .cat-label { background:linear-gradient(45deg,#F7971E,#FFD200); }
    .cat-5  .cat-label { background:linear-gradient(45deg,#11998E,#38EF7D); }
    .cat-6  .cat-label { background:linear-gradient(45deg,#6A11CB,#2575FC); }
    .cat-7  .cat-label { background:linear-gradient(45deg,#36D1DC,#5B86E5); }
    .cat-8  .cat-label { background:linear-gradient(45deg,#FF9A8B,#FF6A88); }
    .cat-9  .cat-label { background:linear-gradient(45deg,#F953C6,#B91D73); }
    .cat-10 .cat-label { background:linear-gradient(45deg,#43C6AC,#F8FFAE); }
    .cat-11 .cat-label { background:linear-gradient(45deg,#833AB4,#FD1D1D); }
    .cat-12 .cat-label { background:linear-gradient(45deg,#06BEB6,#48B1BF); }

    /* Subscribe */
    .subscribe { text-align:center; padding:4rem 0; }
    .subscribe .glass { background: linear-gradient(135deg, #f0f6fa 0%, #e8f1f8 100%); display:inline-block; padding:2rem; max-width:400px; width:100%; }
    .subscribe input { width:100%; padding:.8rem 1rem; border:none; border-radius:30px; margin-bottom:1rem; }
    .subscribe button { padding:.8rem 2rem; border:none; border-radius:30px; background:#FF6B6B; color:#fff; cursor:pointer; }
    .subscribe-message { margin-top:1rem; font-size:0.9rem; }
    .subscribe-message.error { color:#d9230f; }
    .subscribe-message.success { color:#28a745; }

    /* Footer */
    footer { background:#1A1F36; color:#fff; padding:2rem 0; }
    .footer-cols { display:flex; flex-wrap:wrap; gap:2rem; justify-content:center; }
    .footer-col { min-width:150px; }
    .footer-col h4 { margin-bottom:1rem; }
    .footer-col ul { list-style:none; }
    .footer-col li { margin-bottom:.5rem; font-size:.9rem; }
    footer p { text-align:center; color:#6b7280; margin-top:1rem; }

    /* Responsive tweaks */
    @media(max-width:768px){ .product-row { gap:.5rem; } }
    @media(max-width:480px){ .nav-arrow { display:none; } }
  </style>
</head>
<body>
  <header>
    <div class="nav-wrapper container">
      <a href="homepage.html" class="logo">Buyzu</a>
      <div class="search-cart">
        <input type="text" placeholder="Search‚Ä¶">
        <a href="cart.html" class="icon">üõí</a>
      </div>
      <div class="auth-buttons">
        <button class="btn login">Login</button>
        <button class="btn register">Register</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Hero Banner -->
    <section class="hero-banner">
      <div class="container">
        <h1>Welcome to Buyzu</h1>
        <p>Your trendsetting shopping destination</p>
      </div>
    </section>

    <!-- Related-to Banner (modified) -->
    <section class="reco-banner">
      <div class="container">
        <div class="reco-header">
          <h2>Related to items you've viewed</h2>
          <button class="refresh" id="btnBatch">Refresh</button>
        </div>
        <div class="carousel-hero">
          <div class="nav-arrow nav-prev" id="btnPrev" title="Previous">
            <svg viewBox="0 0 24 24"><path d="M15.4 5 14 3.6 6.6 11l7.4 7.4 1.4-1.4L9.4 11z"/></svg>
          </div>
          <div class="track" id="track"></div>
          <div class="nav-arrow nav-next" id="btnNext" title="Next">
            <svg viewBox="0 0 24 24"><path d="m9 3.6-1.4 1.4 7.4 7.4-7.4 7.4L9 21l8.4-8.4z"/></svg>
          </div>
        </div>
      </div>
    </section>

    <!-- Categories -->
    <section class="categories container">
      <h2>Shop by Category</h2>
      <div class="cat-grid">
        <a href="cart.html" class="cat-card cat-1">
          <img src="/images/cat-electronics.jpeg" alt="Electronics">
          <div class="cat-label">Electronics</div>
        </a>
        <a href="#" class="cat-card cat-2">
          <img src="/images/cat-apparel.jpeg" alt="Apparel">
          <div class="cat-label">Apparel</div>
        </a>
        <a href="#" class="cat-card cat-3">
          <img src="/images/cat-beauty.jpeg" alt="Beauty">
          <div class="cat-label">Beauty</div>
        </a>
        <a href="#" class="cat-card cat-4">
          <img src="/images/cat-home.jpeg" alt="Home">
          <div class="cat-label">Home</div>
        </a>
        <a href="#" class="cat-card cat-5">
          <img src="/images/cat-grocery.jpeg" alt="Grocery">
          <div class="cat-label">Grocery</div>
        </a>
        <a href="#" class="cat-card cat-6">
          <img src="/images/cat-toys.jpeg" alt="Toys">
          <div class="cat-label">Toys</div>
        </a>
        <a href="#" class="cat-card cat-7">
          <img src="/images/cat-sports.jpeg" alt="Sports">
          <div class="cat-label">Sports</div>
        </a>
        <a href="#" class="cat-card cat-8">
          <img src="/images/cat-automotive.jpeg" alt="Automotive">
          <div class="cat-label">Automotive</div>
        </a>
        <a href="#" class="cat-card cat-9">
          <img src="/images/cat-books.jpeg" alt="Books">
          <div class="cat-label">Books</div>
        </a>
        <a href="#" class="cat-card cat-10">
          <img src="/images/cat-health.jpeg" alt="Health">
          <div class="cat-label">Health</div>
        </a>
        <a href="#" class="cat-card cat-11">
          <img src="/images/cat-luxury.jpeg" alt="Luxury">
          <div class="cat-label">Luxury</div>
        </a>
        <a href="#" class="cat-card cat-12">
          <img src="/images/cat-tools.jpeg" alt="Tools">
          <div class="cat-label">Tools</div>
        </a>
      </div>
    </section>

    <!-- Hot Sellers -->
    <section class="featured container">
      <h2>Hot Sellers</h2>
      <div class="product-row" id="hotProducts"></div>
    </section>

    <!-- Subscribe -->
    <section class="subscribe">
      <div class="glass">
        <h2>Stay in the Loop</h2>
        <p>Subscribe to get the latest trends & offers</p>
        <form id="subscribeForm" novalidate>
          <input
            type="email"
            id="subscribeEmail"
            placeholder="Your email address"
            required
          >
          <button type="submit" id="subscribeBtn">Subscribe</button>
          <div id="subscribeMessage" class="subscribe-message"></div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <div class="container footer-cols">
      <div class="footer-col"><h4>Support</h4><ul><li><a href="#">FAQ</a></li><li><a href="#">Contact Us</a></li></ul></div>
      <div class="footer-col"><h4>Company</h4><ul><li><a href="#">About Us</a></li><li><a href="#">Careers</a></li></ul></div>
      <div class="footer-col"><h4>Legal</h4><ul><li><a href="#">Terms of Use</a></li><li><a href="#">Privacy Policy</a></li></ul></div>
    </div>
    <p>&copy; 2025 Buyzu. All rights reserved.</p>
  </footer>

  <script>
    const API      = '/api/home_reco?k=8';
    const perBatch = 4;
    const autoGap  = 6000;
    const track    = document.getElementById('track');
    const btnPrev  = document.getElementById('btnPrev');
    const btnNext  = document.getElementById('btnNext');
    const btnBatch = document.getElementById('btnBatch');
    let uid, rawList = [], batchIdx = 0, slideIdx = 0, timer;

    function getCookie(n){ const m=document.cookie.match('(?:^|; )'+n+'=([^;]+)'); return m?decodeURIComponent(m[1]):null; }
    function setCookie(n,v,d=365){ document.cookie = `${n}=${encodeURIComponent(v)};expires=${new Date(Date.now()+d*864e5).toUTCString()};path=/`; }
    function genAnon(){ return 'sess_'+Date.now().toString(36)+'_'+Math.random().toString(16).slice(2,6); }

    function renderSkeleton(){
      track.innerHTML = Array(perBatch).fill().map(_=>`
        <div class="reco-card" style="opacity:.3">
          <div style="height:100px;background:#e0e0e0"></div>
          <div class="reco-body">
            <div style="height:.6rem;background:#e0e0e0;margin-bottom:.4rem"></div>
            <div style="height:.5rem;background:#e0e0e0;margin-bottom:.4rem"></div>
            <div style="height:.5rem;width:50%;background:#e0e0e0"></div>
          </div>
        </div>`).join('');
    }

    function renderCurrent(){
      const start = batchIdx * perBatch;
      track.innerHTML = '';
      const p = rawList[start + slideIdx];
      if(!p){
        track.innerHTML = '<p style="color:#1A1F36;text-align:center;">No recommendations</p>';
        return;
      }
      const card = document.createElement('div');
      card.className = 'reco-card fade-in';
      card.innerHTML = `
        <a href="product.html?id=${p.productID}">
          <img src="/images/${p.img}" alt="${p.productName}">
          <div class="reco-body">
            <div class="reco-name">${p.productName}</div>
            <div class="reco-brand">${p.brandName||''}</div>
            <div class="reco-price">HK$${(+p.price).toFixed(2)}</div>
          </div>
        </a>`;
      track.appendChild(card);
    }

    function startAuto(){
      clearInterval(timer);
      timer = setInterval(()=>{
        slideIdx = (slideIdx + 1) % perBatch;
        renderCurrent();
      }, autoGap);
    }
    function nextSlide(){ slideIdx = (slideIdx + 1) % perBatch; renderCurrent(); }
    function prevSlide(){ slideIdx = (slideIdx - 1 + perBatch) % perBatch; renderCurrent(); }
    function switchBatch(){
      batchIdx = (batchIdx + 1) % Math.ceil(rawList.length / perBatch);
      slideIdx = 0;
      renderCurrent();
      startAuto();
    }

    async function loadReco(){
      renderSkeleton();
      uid = localStorage.getItem('userID') || getCookie('SESSIONID');
      if(!uid){ uid = genAnon(); localStorage.setItem('userID', uid); setCookie('SESSIONID', uid); }
      try {
        const res = await fetch(API, { headers:{ 'X-UserID': uid } });
        rawList = (await res.json()).list || [];
        batchIdx = slideIdx = 0;
        renderCurrent();
        startAuto();
      } catch {
        track.innerHTML = '<p style="color:#1A1F36;text-align:center;">Unable to load recommendations</p>';
      }
    }

    async function loadHotProducts() {
      const container = document.getElementById('hotProducts');
      container.innerHTML = '';
      try {
        const res = await fetch('/api/hot_products?k=8');
        const { list } = await res.json();
        if (!list.length) {
          container.innerHTML = '<p style="color:#1A1F36">ÊöÇÊó†ÁÉ≠ÂçñÂïÜÂìÅ</p>';
          return;
        }
        list.forEach(p => {
          const card = document.createElement('div');
          card.className = 'reco-card small fade-in';
          card.innerHTML = `
            <a href="product.html?id=${p.productID}">
              <img src="/images/${p.img}" alt="${p.productName}">
              <div class="reco-body">
                <div class="reco-name small">${p.productName}</div>
                <div class="reco-brand small">${p.brandName||''}</div>
                <div class="reco-price small">HK$${(+p.price).toFixed(2)}</div>
              </div>
            </a>`;
          container.appendChild(card);
        });
      } catch {
        container.innerHTML = '<p style="color:#1A1F36">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï</p>';
      }
    }

    btnPrev.onclick = ()=>{ prevSlide(); startAuto(); };
    btnNext.onclick = ()=>{ nextSlide(); startAuto(); };
    btnBatch.onclick = switchBatch;
    document.addEventListener('visibilitychange', ()=>{
      document.visibilityState === 'visible' ? startAuto() : clearInterval(timer);
    });

    document.addEventListener('DOMContentLoaded', () => {
      loadHotProducts();
      loadReco();
    });

    // ‚Äî‚Äî Subscription handler ‚Äî‚Äî 
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üì¨ Subscription script loaded');
      const form = document.getElementById('subscribeForm');
      const emailInput = document.getElementById('subscribeEmail');
      const btn = document.getElementById('subscribeBtn');
      const msg = document.getElementById('subscribeMessage');

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }
      function showMessage(text, type) {
        msg.textContent = text;
        msg.className = 'subscribe-message ' + (type||'');
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = emailInput.value.trim();
        showMessage('', '');

        if (!validateEmail(email)) {
          showMessage('Please enter a valid email address.', 'error');
          emailInput.focus();
          return;
        }

        btn.disabled = true;
        btn.textContent = 'Subscribing‚Ä¶';

        try {
          const res = await fetch('/api/subscribe', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.detail || 'Subscription failed');

          showMessage(data.message || 'Thank you for subscribing!', 'success');
          form.reset();
        } catch (err) {
          console.error(err);
          showMessage(err.message, 'error');
        } finally {
          btn.disabled = false;
          btn.textContent = 'Subscribe';
        }
      });
    });
  </script>
</body>
</html>